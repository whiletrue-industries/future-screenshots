<div class="canvas-creator">
  <!-- Template Carousel -->
  @if (showTemplateGallery()) {
    <div class="template-carousel">
      <div class="header">
        <a [routerLink]="['/prescan']" queryParamsHandling="preserve" class="back">
          <img src="/icon-back.svg" alt="Back">
        </a>
        <h2 i18n>Choose a Template</h2>
      </div>
      <div class="carousel-container">
        @if (currentTemplate(); as current) {
          <button class="carousel-nav prev" (click)="previousTemplate()" aria-label="Previous template">
            ‹
          </button>
          <div class="carousel-slide">
            <img [src]="current.preview" [alt]="current.name">
            <div class="template-info">{{ current.name }}</div>
          </div>
          <button class="carousel-nav next" (click)="nextTemplate()" aria-label="Next template">
            ›
          </button>
        }
      </div>
      <button class="button primary use-template" (click)="useCurrentTemplate()" i18n>
        Use this template
      </button>
    </div>
  }
  
  <!-- Canvas Editor -->
  @if (canvas() && !showTemplateGallery()) {
    <div class="editor">
      <div class="header">
        <button class="button" (click)="restart()" i18n>Restart</button>
        <h2>{{ selectedTemplate()?.name }}</h2>
        <div class="mode-toggle">
          <button 
            class="toggle-button" 
            [class.active]="currentMode() === 'type'"
            (click)="setMode('type')" 
            i18n>Write</button>
          <button 
            class="toggle-button" 
            [class.active]="currentMode() === 'draw'"
            (click)="setMode('draw')" 
            i18n>Draw</button>
        </div>
      </div>
      
      <div class="canvas-container">
        <canvas #canvasEl></canvas>
      </div>
      
      <div class="toolbar">
        @if (currentMode() === 'type') {
          <button class="tool-button" (click)="addText()" i18n>
            Add Text
          </button>
          <button class="tool-button" (click)="addTransitionText()" i18n>
            Text on Transition
          </button>
        }
        
        <div class="transition-selector">
          <span i18n>Mark transition:</span>
          <button 
            class="tool-button" 
            [class.selected]="transitionChoice() === 'before'" 
            (click)="selectTransition('before')" 
            i18n>
            Before
          </button>
          <button 
            class="tool-button" 
            [class.selected]="transitionChoice() === 'during'" 
            (click)="selectTransition('during')" 
            i18n>
            During
          </button>
          <button 
            class="tool-button" 
            [class.selected]="transitionChoice() === 'after'" 
            (click)="selectTransition('after')" 
            i18n>
            After
          </button>
        </div>
        
        <button class="tool-button" (click)="undo()" i18n>
          Undo
        </button>
        <button class="tool-button" (click)="clearCanvas()" i18n>
          Clear
        </button>
        <button class="button primary submit-button" (click)="submit()" i18n>
          Submit
        </button>
      </div>
    </div>
  }
</div>
