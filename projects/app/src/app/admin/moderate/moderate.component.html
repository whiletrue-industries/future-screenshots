<div class="moderate-container">
  <header class="topbar" role="banner">
    <div class="brand">
      <span class="logo" aria-hidden="true">‚ú¶</span>
      <h1>Content Moderation</h1>
      @if (workspace()?.source) {
        <span class="workspace-name">{{ workspace()?.source }}</span>
      }
    </div>
    <div class="actions">
      <a href="/admin" class="back-link" aria-label="Back to admin">‚Üê Back</a>
    </div>
  </header>

  <section class="credentials" aria-label="Credentials">
    <div class="creds-row">
      <div class="input-group">
        <label for="workspace-id">Workspace ID</label>
        <input 
          id="workspace-id"
          type="text" 
          [(ngModel)]="workspaceId" 
          placeholder="Enter workspace ID" />
      </div>
      <div class="input-group">
        <label for="api-key">API Key</label>
        <input 
          id="api-key"
          type="text" 
          [(ngModel)]="apiKey" 
          placeholder="Enter API key" />
      </div>
    </div>
  </section>

  <section class="filters-section" aria-label="Status filters">
    <div class="filter-chips">
      @for (f of FILTERS; track $index) {
        <button 
          class="filter-chip"
          [class.active]="_filter === $index"
          (click)="_filter = $index"
          [attr.aria-pressed]="_filter === $index">
          <span class="chip-icon">{{ getFilterIcon($index) }}</span>
          <span class="chip-label">{{ f.name }}</span>
          @if (_filter === $index && items().length > 0) {
            <span class="chip-count">{{ items().length }}</span>
          }
        </button>
      }
    </div>
  </section>

  @if (items().length === 500 || page() > 0) {
    <section class="pagination-section" aria-label="Pagination">
      <button 
        class="pagination-btn" 
        [disabled]="page() === 0" 
        (click)="page.set(page() - 1)"
        aria-label="Previous page">
        ‚Üê Previous
      </button>
      <span class="page-info">Page {{ page() + 1 }}</span>
      <button 
        class="pagination-btn" 
        [disabled]="!items().length" 
        (click)="page.set(page() + 1)"
        aria-label="Next page">
        Next ‚Üí
      </button>
    </section>
  }

  @if (indexLink()) {
    <div class="index-notice" role="alert">
      <span>‚ö†Ô∏è Database index required</span>
      <a [href]="indexLink()" target="_blank" class="index-link">Create index</a>
    </div>
  } @else {
    <div class="items-grid" role="list">
      @for (item of items(); track item._id) {
        <article class="item-card" [attr.data-status]="LEVELS[item._private_moderation]" role="listitem">
          <div class="card-header">
            <button class="user-info" (click)="filterByUser(item.email || item.user_email)" [title]="'Filter by ' + (item.email || item.user_email || 'unknown')">
              <span class="user-email">{{ item.email || item.user_email || 'unknown@user.com' }}</span>
              <span class="user-count">({{ getUserItemCount(item.email || item.user_email) }})</span>
            </button>
          </div>

          <div class="screenshot-container">
            <img [src]="item.screenshot_url" alt="Future scenario screenshot" />
          </div>

          <div class="card-metadata">
            <div class="metadata-row">
              <span class="date">{{ formatDate(item.created_at) }}</span>
              <button 
                class="icon-btn star-btn" 
                [class.active]="item._private_moderation === 5"
                (click)="highlight(item._id)"
                aria-label="Highlight">
                {{ item._private_moderation === 5 ? '‚òÖ' : '‚òÜ' }}
              </button>
              <span class="ai-confidence" [attr.data-confidence]="getConfidenceLevel(item)">
                AI: {{ getAIConfidence(item) }}%
              </span>
              <button class="icon-btn trash-btn" (click)="reject(item._id)" aria-label="Archive">
                üóëÔ∏è
              </button>
            </div>
          </div>

          <div class="card-content">
            <div class="tagline-section">
              @if (editTagline() === item._id) {
                <div class="tagline-edit">
                  <textarea 
                    [(ngModel)]="item.future_scenario_tagline" 
                    placeholder="Enter tagline"
                    rows="3"
                    aria-label="Edit tagline"></textarea>
                  <div class="edit-actions">
                    <button class="btn-icon btn-save" (click)="setTagline(item)" aria-label="Save">‚úì</button>
                    <button class="btn-icon btn-cancel" (click)="editTagline.set(null)" aria-label="Cancel">‚úï</button>
                  </div>
                </div>
              } @else {
                @if (item.future_scenario_tagline) {
                  <div class="tagline" (click)="editTagline.set(item._id)" role="button" tabindex="0">
                    {{ item.future_scenario_tagline }}
                  </div>
                } @else {
                  <div class="tagline tagline-empty" (click)="editTagline.set(item._id)" role="button" tabindex="0">
                    + Add tagline
                  </div>
                }
              }
            </div>

            <div class="tags-section">
              @if (item.tags && item.tags.length > 0) {
                @for (tag of item.tags; track tag) {
                  <span class="tag">{{ tag }}</span>
                }
              }
            </div>

            <div class="properties-selectors">
              <div class="property-selector">
                <select 
                  [(ngModel)]="item.favorable_future" 
                  (change)="setFavorable(item)"
                  [class]="'desirability-select ' + getDesirabilityClass(item.favorable_future)"
                  aria-label="Set desirability">
                  <option [value]="null">Desirability?</option>
                  <option value="prefer">prefer</option>
                  <option value="mostly prefer">prefer-ish</option>
                  <option value="uncertain">uncertain</option>
                  <option value="mostly prevent">prevent-ish</option>
                  <option value="prevent">prevent</option>
                </select>
              </div>
              <div class="property-selector">
                <select 
                  [(ngModel)]="item.plausibility" 
                  (change)="setPlausibility(item)"
                  [class]="'plausibility-select ' + getPlausibilityClass(item.plausibility)"
                  aria-label="Set plausibility">
                  <option [value]="null">Plausibility?</option>
                  <option [value]="100">Projected</option>
                  <option [value]="75">Probable</option>
                  <option [value]="50">Plausible</option>
                  <option [value]="25">Possible</option>
                  <option [value]="0">Preposterous</option>
                </select>
              </div>
            </div>
          </div>

          <div class="card-footer">
            <button 
              class="publish-btn"
              [class.published]="item._private_moderation >= 4"
              [class.archived]="item._private_moderation === 0"
              (click)="item._private_moderation === 0 ? unarchive(item._id) : approve(item._id)"
              [attr.aria-label]="item._private_moderation === 0 ? 'Unarchive' : (item._private_moderation >= 4 ? 'Published' : 'Publish')">
              @if (item._private_moderation === 0) {
                <span class="btn-default">ARCHIVED üóëÔ∏è</span>
                <span class="btn-hover">UNARCHIVE</span>
              } @else if (item._private_moderation >= 4) {
                PUBLISHED ‚úì
              } @else {
                PUBLISH
              }
            </button>
          </div>
        </article>
      }
    </div>
  }
</div>
