<section class="filters-bar" aria-label="Filters">
  <div class="filters-row">
    <div class="filter-group custom-multiselect">
      <label>Status:</label>
      <div class="multiselect-container">
        <button 
          type="button"
          class="multiselect-trigger" 
          (click)="toggleStatusDropdown()">
          <div class="multiselect-content">
            @if (getSelectedStatusCount() === 0) {
              <span class="multiselect-placeholder">Select status...</span>
            } @else if (getSelectedStatusCount() === 6) {
              <span class="multiselect-text">All statuses</span>
            } @else {
              <div class="multiselect-chips">
                @if (shouldShowDeselectedStatusChips()) {
                  @for (status of getDeselectedStatuses(); track status) {
                    <span class="chip chip-deselected">
                      <span class="chip-label">{{ getStatusLabel(status) }}</span>
                      <button 
                        type="button"
                        class="chip-remove" 
                        (click)="$event.stopPropagation(); toggleStatusFilter(status)"
                        title="Add back">√ó</button>
                    </span>
                  }
                } @else {
                  @for (status of filterStatus(); track status) {
                    <span class="chip">
                      {{ getStatusLabel(status) }}
                      <button 
                        type="button"
                        class="chip-remove" 
                        (click)="$event.stopPropagation(); removeStatusChip(status)"
                        title="Remove">√ó</button>
                    </span>
                  }
                }
              </div>
            }
          </div>
          <span class="multiselect-arrow">‚ñº</span>
        </button>
        @if (statusDropdownOpen()) {
          <div class="multiselect-dropdown" (click)="$event.stopPropagation()">
            <div class="multiselect-search">
              <input 
                type="text" 
                class="search-input"
                placeholder="Search statuses..."
                [ngModel]="statusSearchText()" 
                (ngModelChange)="statusSearchText.set($event)"
                (click)="$event.stopPropagation()" />
            </div>
            <div class="multiselect-controls">
              <button 
                type="button"
                class="control-btn" 
                (click)="selectAllStatuses()"
                title="Select all statuses">
                Select All
              </button>
              <button 
                type="button"
                class="control-btn" 
                (click)="deselectAllStatuses()"
                title="Deselect all statuses">
                Deselect All
              </button>
            </div>
            @for (option of getFilteredStatusOptions(); track option.value) {
              <label class="multiselect-option">
                <input 
                  type="checkbox" 
                  [checked]="isStatusSelected(option.value)"
                  (change)="toggleStatusFilter(option.value)" />
                <span class="option-label">{{ option.label }}</span>
                <span class="option-count">{{ getCount(counts().status, option.value) }}</span>
              </label>
            }
          </div>
        }
      </div>
    </div>

    <div class="filter-group">
      <label for="filter-author">Author:</label>
      <select id="filter-author" [ngModel]="filterAuthor()" (ngModelChange)="onAuthorChange($event)">
        <option value="all">all</option>
        @for (author of getAuthorsSortedByCount(); track author) {
          @if (author === 'unknown') {
            <option value="unattributed">unattributed ({{ getCount(counts().author, author) }})</option>
          } @else {
            <option [value]="author">{{ getTruncatedAuthorId(author) }} ({{ getCount(counts().author, author) }})</option>
          }
        }
      </select>
    </div>

    <div class="filter-group custom-multiselect">
      <label>Preference:</label>
      <div class="multiselect-container">
        <button 
          type="button"
          class="multiselect-trigger" 
          (click)="togglePreferenceDropdown()">
          <div class="multiselect-content">
            @if (getSelectedPreferenceCount() === 0) {
              <span class="multiselect-placeholder">Select preference...</span>
            } @else if (getSelectedPreferenceCount() === preferenceOptions.length) {
              <span class="multiselect-text">All preferences</span>
            } @else {
              <div class="multiselect-chips">
                @if (shouldShowDeselectedPreferenceChips()) {
                  @for (pref of getDeselectedPreferences(); track pref) {
                    <span class="chip chip-deselected">
                      <span class="chip-label">{{ getPreferenceLabel(pref) }}</span>
                      <button 
                        type="button"
                        class="chip-remove" 
                        (click)="$event.stopPropagation(); togglePreferenceFilter(pref)"
                        title="Add back">√ó</button>
                    </span>
                  }
                } @else {
                  @for (pref of filterPreference(); track pref) {
                    <span class="chip">
                      {{ getPreferenceLabel(pref) }}
                      <button 
                        type="button"
                        class="chip-remove" 
                        (click)="$event.stopPropagation(); removePreferenceChip(pref)"
                        title="Remove">√ó</button>
                    </span>
                  }
                }
              </div>
            }
          </div>
          <span class="multiselect-arrow">‚ñº</span>
        </button>
        @if (preferenceDropdownOpen()) {
          <div class="multiselect-dropdown" (click)="$event.stopPropagation()">
            <div class="multiselect-search">
              <input 
                type="text" 
                class="search-input"
                placeholder="Search preferences..."
                [ngModel]="preferenceSearchText()" 
                (ngModelChange)="preferenceSearchText.set($event)"
                (click)="$event.stopPropagation()" />
            </div>
            <div class="multiselect-controls">
              <button 
                type="button"
                class="control-btn" 
                (click)="selectAllPreferences()"
                title="Select all preferences">
                Select All
              </button>
              <button 
                type="button"
                class="control-btn" 
                (click)="deselectAllPreferences()"
                title="Deselect all preferences">
                Deselect All
              </button>
            </div>
            @for (pref of getFilteredPreferenceOptions(); track pref) {
              <label class="multiselect-option">
                <input 
                  type="checkbox" 
                  [checked]="isPreferenceSelected(pref)"
                  (change)="togglePreferenceFilter(pref)" />
                <span class="option-label">{{ getPreferenceLabel(pref) }}</span>
                <span class="option-count">{{ getCount(counts().preference, pref) }}</span>
              </label>
            }
          </div>
        }
      </div>
    </div>

    <div class="filter-group custom-multiselect">
      <label>Potential:</label>
      <div class="multiselect-container">
        <button 
          type="button"
          class="multiselect-trigger" 
          (click)="togglePotentialDropdown()">
          <div class="multiselect-content">
            @if (getSelectedPotentialCount() === 0) {
              <span class="multiselect-placeholder">Select potential...</span>
            } @else if (getSelectedPotentialCount() === potentialOptions.length) {
              <span class="multiselect-text">All potentials</span>
            } @else {
              <div class="multiselect-chips">
                @if (shouldShowDeselectedPotentialChips()) {
                  @for (pot of getDeselectedPotentials(); track pot) {
                    <span class="chip chip-deselected">
                      <span class="chip-label">{{ getPotentialLabel(pot) }}</span>
                      <button 
                        type="button"
                        class="chip-remove" 
                        (click)="$event.stopPropagation(); togglePotentialFilter(pot)"
                        title="Add back">√ó</button>
                    </span>
                  }
                } @else {
                  @for (pot of filterPotential(); track pot) {
                    <span class="chip">
                      {{ getPotentialLabel(pot) }}
                      <button 
                        type="button"
                        class="chip-remove" 
                        (click)="$event.stopPropagation(); removePotentialChip(pot)"
                        title="Remove">√ó</button>
                    </span>
                  }
                }
              </div>
            }
          </div>
          <span class="multiselect-arrow">‚ñº</span>
        </button>
        @if (potentialDropdownOpen()) {
          <div class="multiselect-dropdown" (click)="$event.stopPropagation()">
            <div class="multiselect-search">
              <input 
                type="text" 
                class="search-input"
                placeholder="Search potentials..."
                [ngModel]="potentialSearchText()" 
                (ngModelChange)="potentialSearchText.set($event)"
                (click)="$event.stopPropagation()" />
            </div>
            <div class="multiselect-controls">
              <button 
                type="button"
                class="control-btn" 
                (click)="selectAllPotentials()"
                title="Select all potentials">
                Select All
              </button>
              <button 
                type="button"
                class="control-btn" 
                (click)="deselectAllPotentials()"
                title="Deselect all potentials">
                Deselect All
              </button>
            </div>
            @for (pot of getFilteredPotentialOptions(); track pot) {
              <label class="multiselect-option">
                <input 
                  type="checkbox" 
                  [checked]="isPotentialSelected(pot)"
                  (change)="togglePotentialFilter(pot)" />
                <span class="option-label">{{ getPotentialLabel(pot) }}</span>
                <span class="option-count">{{ getCount(counts().potential, pot) }}</span>
              </label>
            }
          </div>
        }
      </div>
    </div>

    <div class="filter-group">
      <label for="filter-type">Type:</label>
      <select id="filter-type" [ngModel]="filterType()" (ngModelChange)="onTypeChange($event)">
        <option value="all">all</option>
        <option value="sign_in_a_demonstration">ü™ß Sign ({{ getCount(counts().type, 'sign_in_a_demonstration') }})</option>
        <option value="social_media_post">üì£ Social ({{ getCount(counts().type, 'social_media_post') }})</option>
        <option value="chat_conversation">üí¨ Chat ({{ getCount(counts().type, 'chat_conversation') }})</option>
        <option value="notification_alert">üîî Alert ({{ getCount(counts().type, 'notification_alert') }})</option>
        <option value="ai_agent_query">ü§ñ AI ({{ getCount(counts().type, 'ai_agent_query') }})</option>
        <option value="review">‚≠ê Review ({{ getCount(counts().type, 'review') }})</option>
        <option value="map_visualization">üó∫Ô∏è Map ({{ getCount(counts().type, 'map_visualization') }})</option>
        <option value="photograph">üì∏ Photo ({{ getCount(counts().type, 'photograph') }})</option>
      </select>
    </div>

    <div class="filter-group search-group">
      <label for="filter-search">Search:</label>
      <input 
        id="filter-search" 
        type="text" 
        [ngModel]="searchText()" 
        (ngModelChange)="onSearchChange($event)" 
        placeholder="any text" />
    </div>

    <div class="filter-group">
      <label for="order-by">Order by:</label>
      <select id="order-by" [ngModel]="orderBy()" (ngModelChange)="onOrderByChange($event)">
        <option value="date">Date</option>
        <option value="status">Status</option>
        <option value="author">Author</option>
        <option value="confidence">AI Confidence</option>
        <option value="type">Type</option>
        <option value="preference">Preference</option>
      </select>
    </div>

    <div class="filter-info">
      <span class="count-display">{{ filteredCount() }} / {{ totalCount() }}</span>
      @if (showViewToggle()) {
        <button class="view-toggle-btn" (click)="toggleViewMode()" [attr.aria-label]="viewMode() === 'list' ? 'Switch to grid view' : 'Switch to list view'" [title]="viewMode() === 'list' ? 'Grid view' : 'List view'">
          {{ viewMode() === 'list' ? '‚äû' : '‚ò∞' }}
        </button>
      }
    </div>
  </div>
</section>
