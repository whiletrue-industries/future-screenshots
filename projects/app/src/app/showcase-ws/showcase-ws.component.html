<div class='container' [class.dragging]='isDragging()' [class.hovering]='isHoveringItem()' #container></div>

<!-- Preloader - shown until layout has fully loaded and composed -->
@if (isLayoutLoading()) {
  <div class='preloader'>
    <div class='spinner'></div>
  </div>
}

<!-- QR Code (Only shown if additional contributions are allowed, not on mobile) -->
@if (allowAdditionalContributions()) {
  <app-qrcode 
    [small]='qrSmall()' 
    [url]='qrUrl()' 
    (click)='toggleQrSize()'
    class='hide-on-mobile qr-clickable'></app-qrcode>
}

<!-- Evaluation Sidebar -->
<app-evaluation-sidebar
  [isOpen]='sidebarOpen() && canEditSelectedItem()'
  [itemId]='selectedItemId()'
  [itemKey]='selectedItemKey()'
  [workspaceId]='workspace()'
  [apiKey]='api_key()'
  [adminKey]='admin_key()'
  [lang]='lang()'
  (close)='onSidebarClose()'
  (metadataUpdated)='onMetadataUpdated($event)'
></app-evaluation-sidebar>

<!-- Back Button -->
<button 
  class='back-button'
  (click)='goBack()'
  title='Back to Home'>
  <svg viewBox='0 0 24 24' class='button-icon'>
    <path d='M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z' fill='currentColor'/>
  </svg>
</button>

<!-- Workspace Title -->
@if (workspaceTitle()) {
<div class='workspace-title' #titleElement [class.needs-animation]='titleNeedsAnimation()'>
  {{ workspaceTitle() }}@if (titleNeedsAnimation()) {   ❖   {{ workspaceTitle() }}}
</div>
}

<!-- Zoom Controls (Top Right) -->
<div class='zoom-controls' [class.sidebar-open]='sidebarOpen()'>
  <div class='zoom-buttons'>
    <!-- Search Controls -->
    <div class='search-section'>
      <button 
        class='zoom-button'
        [class.active]='searchActive()'
        (click)='searchActive.set(!searchActive())'
        title='Search'>
        <svg viewBox='0 0 24 24' class='button-icon'>
          <circle cx='11' cy='11' r='8' stroke='currentColor' stroke-width='2' fill='none'/>
          <path d='M21 21l-4.35-4.35' stroke='currentColor' stroke-width='2' stroke-linecap='round'/>
        </svg>
      </button>
      
      @if (searchActive()) {
        <div class='search-input-container'>
          <input 
            type='text' 
            class='search-input'
            placeholder='Search...'
            [value]='searchText()'
            (input)='onSearchInput($event)'
            (keydown.escape)='clearSearch()'
          />
          @if (searchText()) {
            <button 
              class='search-clear' 
              (click)='clearSearch()'
              title='Clear search'>
              ×
            </button>
          }
        </div>
      }
    </div>

    <button 
      class='zoom-button hide-on-mobile'
      (click)='zoomIn()'
      title='Zoom In (+)'>
      <svg viewBox='0 0 24 24' class='button-icon'>
        <path d='M12 5v14M5 12h14' stroke='currentColor' stroke-width='2' stroke-linecap='round'/>
      </svg>
    </button>
    <button 
      class='zoom-button hide-on-mobile'
      (click)='zoomOut()'
      title='Zoom Out (-)'>
      <svg viewBox='0 0 24 24' class='button-icon'>
        <path d='M5 12h14' stroke='currentColor' stroke-width='2' stroke-linecap='round'/>
      </svg>
    </button>
    <button 
      class='zoom-button'
      (click)='resetView()'
      title='Reset View (R)'>
      <svg viewBox='0 0 24 24' class='button-icon'>
        <!-- Top-left arrow -->
        <path d='M2 2l4 0 0 2 -2 0 0 2 -2 0 0 -4' fill='currentColor'/>
        <!-- Top-right arrow -->
        <path d='M22 2l-4 0 0 2 2 0 0 2 2 0 0 -4' fill='currentColor'/>
        <!-- Bottom-left arrow -->
        <path d='M2 22l4 0 0 -2 -2 0 0 -2 -2 0 0 4' fill='currentColor'/>
        <!-- Bottom-right arrow -->
        <path d='M22 22l-4 0 0 -2 2 0 0 -2 2 0 0 4' fill='currentColor'/>
      </svg>
    </button>
  </div>

  @if (isAdmin()) {
    <button 
      class='showcase-toggle hide-on-mobile'
      [class.active]='enableRandomShowcase()'
      (click)='toggleRandomShowcase()'
      title='Toggle Random Showcase'>
      <svg viewBox='0 0 24 24' class='button-icon'>
        <circle cx='12' cy='8' r='2' fill='currentColor'/>
        <circle cx='12' cy='16' r='2' fill='currentColor'/>
        <circle cx='6' cy='12' r='2' fill='currentColor'/>
        <circle cx='18' cy='12' r='2' fill='currentColor'/>
      </svg>
    </button>
  }
  
</div>

<!-- Layout Selection Toggle (Visible to All Users) -->
<div class='layout-toggle-centered'>
  <div class='layout-toggle'>
    <div class='toggle-background'>
    </div>
    <div class='toggle-buttons'>
      <button 
        class='toggle-button map-button'
        [class.active]='currentLayout() === "svg"'
        (click)='switchToSvgLayout()'
        title='Map Layout'>
        <div class='button-content'>
          <img src='/icon-cone.svg' alt='Map' class='button-icon'>
          <span class='button-label'>Map</span>
        </div>
      </button>
      <button 
        class='toggle-button clusters-button'
        [class.active]='currentLayout() === "circle-packing"'
        (click)='switchToCirclePackingLayout()'
        title='Clusters Layout'>
        <div class='button-content'>
          <img src='/icon-clusters.svg' alt='Clusters' class='button-icon'>
          <span class='button-label'>Clusters</span>
        </div>
      </button>
    </div>
  </div>
  
  <!-- SVG Auto-Positioning Toggle (only visible when SVG layout is active and user is admin) -->
  @if (currentLayout() === 'svg' && isAdmin()) {
    <div class='svg-auto-toggle'>
      <button 
        class='svg-auto-button'
        [class.active]='enableSvgAutoPositioning()'
        (click)='toggleSvgAutoPositioning()'
        title='Toggle SVG Auto-Positioning'>
        <svg viewBox='0 0 24 24' class='button-icon'>
          <path d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm3.5-9c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zm-7 0c.83 0 1.5-.67 1.5-1.5S9.33 8 8.5 8 7 8.67 7 9.5 7.67 11 8.5 11zm3.5 6.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5z' fill='currentColor'/>
        </svg>
      </button>
    </div>
  }
</div>

